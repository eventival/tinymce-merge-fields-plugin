!function(){"use strict";var n='\n<svg width="24" height="24"  x="0px" y="0px" viewBox="0 0 26 26" >\n  <g>\n    <path style="fill:#030104;" d="M23,2H3C1.344,2,0,3.343,0,5v16c0,1.656,1.344,3,3,3h20c1.656,0,3-1.344,3-3V5\n    C26,3.343,24.656,2,23,2z M24,21c0,0.551-0.449,1-1,1H3c-0.551,0-1-0.449-1-1V7h22V21z"/>\n    <path style="fill:#030104;" d="M19.402,14.215c0,1.029-0.125,1.926-0.374,2.691c-0.147,0.453-0.464,1.16-0.935,2.094h1.166\n    c0.546-0.87,0.923-1.553,1.109-2.024c0.335-0.826,0.502-1.766,0.502-2.819c0-0.402-0.036-0.82-0.109-1.255\n    c-0.073-0.434-0.195-0.874-0.366-1.318c-0.135-0.359-0.261-0.642-0.376-0.847c-0.069-0.121-0.224-0.377-0.446-0.736h-1.206\n    c0.276,0.565,0.482,1.035,0.603,1.391C19.258,12.245,19.402,13.187,19.402,14.215z"/>\n    <path style="fill:#030104;" d="M6.563,14.215c0,1.029,0.125,1.926,0.374,2.691C7.084,17.359,7.4,18.066,7.871,19H6.705\n    c-0.546-0.87-0.923-1.553-1.109-2.024c-0.335-0.826-0.502-1.766-0.502-2.819c0-0.402,0.036-0.82,0.109-1.255\n    c0.073-0.434,0.195-0.874,0.366-1.318c0.135-0.359,0.261-0.642,0.376-0.847c0.07-0.122,0.224-0.378,0.447-0.737h1.206\n    c-0.276,0.565-0.482,1.035-0.603,1.391C6.707,12.245,6.563,13.187,6.563,14.215z"/>\n    <g>\n        <path style="fill:#030104;" d="M17.03,12.088c0,0.378-0.12,0.679-0.361,0.902s-0.535,0.335-0.882,0.335\n        c-0.208,0-0.413-0.026-0.615-0.078c-0.201-0.052-0.376-0.104-0.524-0.156c-0.069,0.048-0.171,0.152-0.305,0.313\n        c-0.135,0.161-0.286,0.356-0.456,0.586c0.155,0.665,0.281,1.137,0.377,1.417c0.095,0.279,0.186,0.563,0.272,0.85\n        c0.074,0.228,0.183,0.407,0.325,0.536c0.144,0.129,0.369,0.193,0.678,0.193c0.113,0,0.254-0.021,0.423-0.065\n        c0.17-0.043,0.309-0.087,0.417-0.13l-0.144,0.589c-0.43,0.184-0.805,0.317-1.125,0.399c-0.321,0.084-0.607,0.125-0.859,0.125\n        c-0.183,0-0.362-0.018-0.541-0.052c-0.178-0.035-0.341-0.098-0.487-0.189c-0.16-0.096-0.296-0.215-0.407-0.357\n        c-0.11-0.144-0.205-0.344-0.283-0.6c-0.053-0.16-0.101-0.343-0.144-0.547c-0.044-0.204-0.088-0.385-0.132-0.541\n        c-0.126,0.188-0.217,0.326-0.273,0.417c-0.057,0.092-0.139,0.22-0.247,0.385c-0.343,0.525-0.641,0.899-0.893,1.123\n        s-0.554,0.335-0.905,0.335c-0.265,0-0.49-0.089-0.677-0.267s-0.28-0.41-0.28-0.696c0-0.387,0.12-0.691,0.361-0.916\n        c0.242-0.223,0.536-0.335,0.885-0.335c0.208,0,0.408,0.025,0.6,0.075s0.372,0.105,0.541,0.166\n        c0.065-0.053,0.167-0.154,0.304-0.307c0.137-0.151,0.285-0.34,0.446-0.566c-0.145-0.581-0.262-1.02-0.354-1.315\n        c-0.093-0.295-0.186-0.588-0.282-0.879c-0.078-0.232-0.191-0.412-0.339-0.538c-0.147-0.128-0.369-0.191-0.664-0.191\n        c-0.131,0-0.276,0.023-0.437,0.068c-0.161,0.046-0.295,0.088-0.403,0.127l0.143-0.589c0.391-0.175,0.76-0.307,1.109-0.394\n        c0.35-0.088,0.642-0.131,0.876-0.131c0.213,0,0.395,0.016,0.547,0.046c0.151,0.03,0.312,0.095,0.48,0.195\n        c0.156,0.095,0.292,0.216,0.407,0.361s0.21,0.344,0.283,0.596c0.054,0.174,0.102,0.354,0.146,0.54\n        c0.044,0.188,0.081,0.348,0.112,0.482c0.091-0.139,0.186-0.282,0.283-0.43s0.181-0.278,0.25-0.391\n        c0.335-0.525,0.634-0.902,0.899-1.13c0.264-0.229,0.563-0.342,0.897-0.342c0.273,0,0.501,0.09,0.684,0.27\n        C16.939,11.568,17.03,11.802,17.03,12.088z"/>\n      </g>\n    </g>\n</svg>\n',c=function(){return(c=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e}).apply(this,arguments)};function a(e,n,t){if(t||2===arguments.length)for(var r,i=0,c=n.length;i<c;i++)!r&&i in n||((r=r||Array.prototype.slice.call(n,0,i))[i]=n[i]);return e.concat(r||Array.prototype.slice.call(n))}var t=(e.prototype.findPath=function(r){function i(e,n){return n.value===r?a(a([],e),[n.name]):(!Array.isArray(n.items)||0<(t=n.items.reduce(i,[])).length&&(e=a([n.name],t)),e);var t}return this.tree.reduce(i,[])},e.prototype.valueExists=function(e){return 0<this.findPath(e).length},e.prototype.flatten=function(){var r=function(e,n){var t;return Array.isArray(n.items)&&(0<(t=n.items.reduce(r,[])).length&&(e=a(a([],e),t)),delete n.items),e=a(a([],e),[n])};return this.getCopy().reduce(r,[])},e.prototype.getCopy=function(){function n(e){return Array.isArray(e.items)&&0<e.items.length?c(c({},e),{items:e.items.map(n)}):c({},e)}return this.tree.map(n)},e.prototype.findValue=function(n){return this.flatten().find(function(e){return!!e.value&&e.value===n})},e.prototype.filter=function(r){function i(e,n){return r(n)?e.push(n):!Array.isArray(n.items)||(t=n.items.reduce(i,[])).length&&e.push(c(c({},n),{items:t})),e;var t}return this.tree.reduce(i,[])},e.prototype.getTree=function(){return this.tree},e);function e(e){this.tree=e}function o(e){return new t(e.getParam("merge_fields",[]))}function l(e){return e.getParam("merge_field_prefix","{{")}function u(e){return e.getParam("merge_field_suffix","}}")}function s(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.join(" ").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim().replace(/[^a-z0-9 ]/g,"").replace(/\s+/g,"-")}function i(c,e,a,o){return e.map(function(e){return'<li class="tree__item">'+(i=e,Array.isArray(i.items)&&0<i.items.length?(n=e,t=a,'\n    <input type="checkbox" '+((r=o)?'checked="checked"':"")+'  id="'+s("tinymce-merge-fields",(i=c).id,n.name,t)+'" />\n    <label for="'+s("tinymce-merge-fields",i.id,n.name,t)+'" class="tree__label cursor-pointer">'+n.name+"</label>\n    "+d(i,n.items,t++,r)+"\n  "):(r=e,'<button\n          type="button"\n          class="tree__label cursor-pointer merge-field-button"\n          data-value="'+encodeURI(r.value)+'"\n          data-help="'+encodeURI(r.help)+'"\n          data-name="'+encodeURI(r.name)+'">\n          '+r.name+"\n          </button>\n"))+(e.help?(e=e.help)?'<span class="info tooltip">\n        <img src="data:image/svg+xml;base64,'+btoa('\n  <svg width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <path d="M12,4 C13.1041722,4 14.1406202,4.20833125 15.109375,4.625 C16.0885466,5.04166875 16.9401005,5.61197555 17.6640625,6.3359375 C18.3880245,7.05989945 18.9583313,7.91145344 19.375,8.890625 C19.7916687,9.85937984 20,10.8958278 20,12 C20,13.1041722 19.7916687,14.1406202 19.375,15.109375 C18.9583313,16.0885466 18.3880245,16.9401005 17.6640625,17.6640625 C16.9401005,18.3880245 16.0885466,18.9583313 15.109375,19.375 C14.1406202,19.7916687 13.1041722,20 12,20 C10.8958278,20 9.85937984,19.7916687 8.890625,19.375 C7.91145344,18.9583313 7.05989945,18.3880245 6.3359375,17.6640625 C5.61197555,16.9401005 5.04166875,16.0885466 4.625,15.109375 C4.20833125,14.1406202 4,13.1041722 4,12 C4,10.8958278 4.20833125,9.85937984 4.625,8.890625 C5.04166875,7.91145344 5.61197555,7.05989945 6.3359375,6.3359375 C7.05989945,5.61197555 7.91145344,5.04166875 8.890625,4.625 C9.85937984,4.20833125 10.8958278,4 12,4 Z M11,7 L11,9 L13,9 L13,7 L11,7 Z M14,17 L14,16 L13,16 L13,11 L10,11 L10,12 L11,12 L11,16 L10,16 L10,17 L14,17 Z" fill="#000000"></path>\n    </g>\n</svg>\n')+'" alt="info" width="24px" height="24px" />\n        <span class="tooltip-text">'+e+"</span>\n  </span>":"":"")+"</li>";var n,t,r,i}).join("")}function d(e,n,t,r){return"\n    <ul "+(0===(t=void 0===t?0:t)&&'class="tree"')+">\n        "+i(e,n,t,r=void 0===r?!1:r)+"\n    </ul>\n  "}function f(e,n){return'<span class="merge-value" data-original-field-value="'+encodeURI(n.value)+'" contenteditable="false">\n'+(t=n,(e=(n=e).getParam("merge_field_separator",">"))?o(n).findPath(t.value).join(" "+e+" "):t.name)+"\n</span>";var t}var r="InsertMergeField",m=function(t){t.addCommand(r,function(e,n){t.execCommand("mceInsertContent",e,f(t,n))})};function g(e){return e.$.find("#tinymce-merge-fields-"+e.id)[0]}function p(r){return function(e){var n,t=null===(n=e.target)||void 0===n?void 0:n.value,e=g(r);(n=(n=r).$.find("#tinymce-merge-fields-"+n.id+" .tree")[0])&&n.remove(),""!==t&&null!=t?e.insertAdjacentHTML("beforeend",d(r,o(r).filter(function(e){return 0<=e.name.toLowerCase().indexOf(t.toLowerCase())}),0,!0)):e.insertAdjacentHTML("beforeend",d(r,o(r).getTree()))}}function h(e){var n;e.$.find("#tinymce-merge-fields-"+e.id+" .search")[0].addEventListener("input",p(e)),g(n=e).addEventListener("click",function(e){"button"===e.target.type&&e.target.classList.contains("merge-field-button")&&n.execCommand(r,!1,{value:decodeURI(e.target.dataset.value),help:decodeURI(e.target.dataset.help),name:decodeURI(e.target.dataset.name)})})}function v(e){return Array.from(e[Symbol.iterator]()).reduce(function(e,n){return e=-1!=="^$\\.*+?()[]{}|".indexOf(n)?a(a([],e),["\\",n]):e},[]).join("")}function y(e,n){return new RegExp(v(e)+"([a-zA-Z.0-9 _]*)?"+v(n),"g")}function C(r){var i=o(r),t=[];tinymce.walk(r.getBody(),function(e){var n=y(l(r),u(r));1==e.nodeType&&e.textContent&&n.test(e.textContent)&&(t=a(a([],t),[e]))},"childNodes"),t.forEach(function(e){var t=e.textContent;!function(e,n){for(var t=y(l(e),u(e)),r=[],i=t.exec(n);null!==i;)r=a(a([],r),[i[0]]),i=t.exec(n);return r}(r,e.textContent).forEach(function(e){var n;i.valueExists(e)&&(t=t.replace(e,(n=r,e=i.findValue(e),n.fire("mergeFieldToHTML",{value:e.name,cleanValue:e.value}),f(n,e))))}),t!==e.textContent&&r.dom.replace(r.dom.create("p",{},t),e)})}var x=function(t){return{tooltip:"Merge Fields",icon:"merge-field",onShow:function(e){var n;n=t,e.element().innerHTML='\n    <div class="tinymce-merge-fields" id="tinymce-merge-fields-'+n.id+'">\n        \n    <input type="text" class="search" placeholder="search"/>\n  \n        '+d(n,o(n).getTree())+"\n    </div>\n  ",h(t)}}},b=function(t){t.on("nodechange",function(){C(t)}),t.on("keyup",function(){C(t)}),t.on("beforegetcontent",function(e){return"raw"===e.format?C(t):(n=t,void tinymce.walk(n.getBody(),function(e){1==e.nodeType&&null!==e.getAttribute("data-original-field-value")&&n.dom.replace(n.dom.create("span",{},decodeURI(e.getAttribute("data-original-field-value"))),e)},"childNodes"));var n})};tinymce.PluginManager.add("merge-fields",function(e){e.ui.registry.addIcon("merge-field",n),e.ui.registry.addSidebar("merge-fields-sidebar",x(e)),e.on("init",function(){m(e)}),b(e)})}();